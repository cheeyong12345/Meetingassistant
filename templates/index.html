{% extends "base.html" %}

{% block title %}Dashboard - Meeting Assistant{% endblock %}

{% block content %}
<div class="grid grid-cols-3" style="grid-template-columns: 1fr 2fr;">
    <!-- Left Column: Meeting Controls -->
    <div>
        <!-- Meeting Control Card -->
        <div class="card card-sticky">
            <div class="card-header">
                <h3 class="card-title">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                    </svg>
                    Meeting Control
                </h3>
            </div>
            <div class="card-body">
                <!-- Meeting Status -->
                <div id="meeting-status" class="mb-3">
                    <div class="alert alert-info">
                        <div class="alert-icon">â„¹</div>
                        <div class="alert-content">
                            No active meeting
                        </div>
                    </div>
                </div>

                <!-- Recording Indicator with Waveform -->
                <div id="recording-indicator" class="recording-indicator hidden mb-3" style="display: none;">
                    <div class="recording-indicator-dot"></div>
                    <span>Recording</span>
                </div>

                <!-- Waveform Visualizer -->
                <div id="waveform-container" class="waveform-container hidden" style="display: none; margin-bottom: 1.5rem;"></div>

                <!-- Start Meeting Form -->
                <div id="start-meeting-form">
                    <form id="meeting-form">
                        <div class="form-group">
                            <label for="meeting-title" class="form-label">Meeting Title</label>
                            <input type="text" class="form-input" id="meeting-title"
                                   placeholder="Team Standup" autocomplete="off">
                            <span class="form-help">Give your meeting a descriptive title</span>
                        </div>

                        <div class="form-group">
                            <label for="participants" class="form-label">Participants</label>
                            <input type="text" class="form-input" id="participants"
                                   placeholder="John, Sarah, Mike" autocomplete="off">
                            <span class="form-help">Comma-separated list</span>
                        </div>

                        <button type="submit" class="btn btn-secondary btn-lg btn-block">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                            </svg>
                            Start Meeting
                        </button>
                    </form>
                </div>

                <!-- Stop Meeting Button -->
                <div id="stop-meeting-form" class="hidden" style="display: none;">
                    <button id="stop-meeting-btn" class="btn btn-danger btn-lg btn-block">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                        </svg>
                        Stop Meeting
                    </button>
                </div>
            </div>
        </div>

        <!-- Engine Status Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13 7H7v6h6V7z"/>
                        <path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z" clip-rule="evenodd"/>
                    </svg>
                    Engine Status
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong style="font-size: var(--font-size-sm); color: var(--color-gray-600);">Speech-to-Text:</strong><br>
                    <span id="stt-engine" class="badge badge-secondary">Not initialized</span>
                </div>
                <div class="mb-3">
                    <strong style="font-size: var(--font-size-sm); color: var(--color-gray-600);">Summarization:</strong><br>
                    <span id="sum-engine" class="badge badge-secondary">Not initialized</span>
                </div>
                <button id="refresh-status" class="btn btn-outline btn-sm btn-block">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                    </svg>
                    Refresh Status
                </button>
            </div>
        </div>
    </div>

    <!-- Right Column: Live Transcript and Metrics -->
    <div>
        <!-- Real-time Metrics -->
        <div class="metrics-grid mb-3">
            <div class="metric-card">
                <div class="metric-icon">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="metric-label">Duration</div>
                <div class="metric-value" id="meeting-duration">00:00</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="metric-label">Words</div>
                <div class="metric-value" id="word-count">0</div>
            </div>
        </div>

        <!-- Live Transcript Card -->
        <div class="card">
            <div class="card-header flex justify-between items-center" style="display: flex; align-items: center; justify-content: space-between;">
                <h3 class="card-title" style="margin: 0;">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                    </svg>
                    Live Transcript
                </h3>

                <div class="form-switch" style="margin: 0;">
                    <input type="checkbox" id="auto-scroll" checked>
                    <label for="auto-scroll" style="margin: 0; font-size: var(--font-size-sm); cursor: pointer;">Auto-scroll</label>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div id="transcript" class="transcript-container">
                    <div class="transcript-empty">
                        <div class="transcript-empty-icon">ðŸŽ¤</div>
                        <div>Start a meeting to see the live transcript here...</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-gray-400);">
                            Press <kbd style="padding: 0.125rem 0.375rem; background: var(--color-gray-200); border-radius: var(--radius-sm);">Ctrl+S</kbd> to start
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer flex justify-between items-center" style="display: flex; align-items: center; justify-content: space-between;">
                <div style="font-size: var(--font-size-sm); color: var(--color-gray-600);">
                    <span id="transcript-status">Ready</span>
                </div>
                <div>
                    <button id="copy-transcript" class="btn btn-ghost btn-sm" title="Copy transcript">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                        </svg>
                        Copy
                    </button>
                    <button id="download-transcript" class="btn btn-ghost btn-sm" title="Download transcript">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Download
                    </button>
                </div>
            </div>
        </div>

        <!-- Meeting Summary Card -->
        <div id="meeting-summary" class="card mt-3 hidden" style="display: none;">
            <div class="card-header">
                <h3 class="card-title">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                    </svg>
                    Meeting Summary
                </h3>
            </div>
            <div class="card-body">
                <div id="summary-content">
                    <!-- Summary will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Dashboard-specific functionality
document.addEventListener('DOMContentLoaded', function() {
    // Meeting form submission
    const meetingForm = document.getElementById('meeting-form');
    if (meetingForm) {
        meetingForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const title = document.getElementById('meeting-title').value.trim();
            const participants = document.getElementById('participants').value.trim();

            await MeetingManager.startMeeting(title, participants);
        });
    }

    // Stop meeting button
    const stopBtn = document.getElementById('stop-meeting-btn');
    if (stopBtn) {
        stopBtn.addEventListener('click', async function() {
            if (confirm('Are you sure you want to stop the meeting?')) {
                await MeetingManager.stopMeeting();
            }
        });
    }

    // Refresh status button
    const refreshBtn = document.getElementById('refresh-status');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            StatusManager.loadEngineStatus();
            NotificationManager.show('Status refreshed', 'info', 2000);
        });
    }

    // Auto-scroll toggle
    const autoScrollToggle = document.getElementById('auto-scroll');
    if (autoScrollToggle) {
        autoScrollToggle.addEventListener('change', function() {
            AppState.settings.autoScroll = this.checked;
            StorageManager.save('settings', AppState.settings);
        });
    }

    // Copy transcript button
    const copyBtn = document.getElementById('copy-transcript');
    if (copyBtn) {
        copyBtn.addEventListener('click', async function() {
            const text = TranscriptManager.getText();
            if (text) {
                try {
                    await Utils.copyToClipboard(text);
                    NotificationManager.show('Transcript copied to clipboard', 'success');
                } catch (error) {
                    NotificationManager.show('Failed to copy transcript', 'danger');
                }
            } else {
                NotificationManager.show('No transcript to copy', 'warning');
            }
        });
    }

    // Download transcript button
    const downloadBtn = document.getElementById('download-transcript');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', function() {
            const text = TranscriptManager.getText();
            if (text) {
                const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                Utils.downloadText(text, `transcript-${timestamp}.txt`);
                NotificationManager.show('Transcript downloaded', 'success');
            } else {
                NotificationManager.show('No transcript to download', 'warning');
            }
        });
    }
});
</script>
{% endblock %}
